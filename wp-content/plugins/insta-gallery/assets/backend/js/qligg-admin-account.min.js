
(function(c){_.mixin({escapeHtml:function(e){return e.replace("&amp;",/&/g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#039;/g,"'")},getFormData:function(e){return e.serializeJSON()}});var b=Backbone.Model.extend({defaults:{access_token:""}});var a=Backbone.View.extend({events:{"change input":"enable","click .media-modal-close":"close","submit .media-modal-form":"submit"},templates:{},initialize:function(){_.bindAll(this,"open","render","close","enable","submit");this.init();this.open()},init:function(){this.templates.window=wp.template("qligg-modal-account-main")},render:function(){var e=this;e.$el.html(e.templates.window(e.model.attributes))},updateModel:function(i){i.preventDefault();var h=this,f=h.$el.find("form");var g=_.getFormData(f);this.model.set(g)},enable:function(f){c(".media-modal-submit").removeProp("disabled");this.updateModel(f)},open:function(f){this.render();c("body").addClass("modal-open").append(this.$el)},close:function(f){f.preventDefault();this.undelegateEvents();c(document).off("focusin");c("body").removeClass("modal-open");this.remove();return},submit:function(j){j.preventDefault();var i=this,g=i.$el.find("#qligg_modal"),h=g.find(".settings-save-status .spinner"),f=g.find(".settings-save-status .saved");c.ajax({url:ajaxurl,data:{action:"qligg_add_token",nonce:qligg_account.nonce.qligg_add_token,access_token:i.model.attributes.access_token},dataType:"json",type:"POST",beforeSend:function(){c(".media-modal-submit").prop("disabled",true);h.addClass("is-active")},complete:function(){h.removeClass("is-active")},error:function(e){alert("Error!")},success:function(e){console.log(e);if(e.success){g.addClass("reload");f.addClass("is-active");_.delay(function(){f.removeClass("is-active")},5000);i.close(j);window.location.reload()}else{alert(e.data)}}});return false}});var d=Backbone.View.extend({initialize:function(g){var f=new b();f.set({access_token:""});new a({model:f})}});c(document).on("click","[data-qligg-copy-token]",function(f){f.preventDefault();c(c(this).data("qligg-copy-token")).select();document.execCommand("copy")});c(document).on("click","[data-qligg-delete-token]",function(i){i.preventDefault();var j=confirm(qligg_account.message.confirm_delete);if(!j){return false}var h=c(i.target),f=h.closest("[data-token_id]").data("token_id"),g=c(i.target).closest("td").find(".spinner");c.ajax({url:ajaxurl,type:"post",data:{action:"qligg_delete_token",token_id:f,nonce:qligg_account.nonce.qligg_delete_token},beforeSend:function(){g.addClass("is-active")},success:function(e){if(e.success){setTimeout(function(){window.location.reload()},300)}else{alert(e.data)}},complete:function(){g.removeClass("is-active")},error:function(e,k){console.log(k)}})});c("#qligg-add-token").on("click",function(f){f.preventDefault();new d(f)});c(document).on("ready",function(i){var h=window.location.hash,j=h.substring(14);if(j.length>40){var g=c("#qligg-generate-token"),f=g.closest("p").find(".spinner");c.ajax({url:ajaxurl,type:"post",data:{action:"qligg_add_token",access_token:j,nonce:qligg_account.nonce.qligg_add_token},beforeSend:function(){g.css({opacity:".5","pointer-events":"none"});f.addClass("is-active")},success:function(e){if(e.success){setTimeout(function(){window.location.reload()},300)}else{alert(e.data)}},complete:function(){g.removeAttr("style");f.removeClass("is-active");window.location.hash="";window.location.href.split("#")[0]},error:function(e,k){console.log(k)}})}})})(jQuery);